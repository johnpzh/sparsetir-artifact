cd ../3rdparty/sputnik
if [ -d "build/" ]; then
    echo "sputnik was built correctly"
    cd build
else
    mkdir -p build
    cd build
    # Use 75 for turing architecture
    cmake .. -DCMAKE_BUILD_TYPE=Release -DBUILD_TEST=ON -DBUILD_BENCHMARK=ON -DCUDA_ARCHS="80"
    make -j16
fi

cd sputnik
for dataset in bert.encoder.layer.0.attention.output.dense.weight.npz   bert.encoder.layer.1.attention.output.dense.weight.npz  bert.encoder.layer.4.attention.output.dense.weight.npz  bert.encoder.layer.7.attention.output.dense.weight.npz bert.encoder.layer.0.attention.self.key.weight.npz       bert.encoder.layer.1.attention.self.key.weight.npz      bert.encoder.layer.4.attention.self.key.weight.npz      bert.encoder.layer.7.attention.self.key.weight.npz bert.encoder.layer.0.attention.self.query.weight.npz     bert.encoder.layer.1.attention.self.query.weight.npz    bert.encoder.layer.4.attention.self.query.weight.npz    bert.encoder.layer.7.attention.self.query.weight.npz bert.encoder.layer.0.attention.self.value.weight.npz     bert.encoder.layer.1.attention.self.value.weight.npz    bert.encoder.layer.4.attention.self.value.weight.npz    bert.encoder.layer.7.attention.self.value.weight.npz bert.encoder.layer.0.intermediate.dense.weight.npz       bert.encoder.layer.1.intermediate.dense.weight.npz      bert.encoder.layer.4.intermediate.dense.weight.npz      bert.encoder.layer.7.intermediate.dense.weight.npz bert.encoder.layer.0.output.dense.weight.npz             bert.encoder.layer.1.output.dense.weight.npz            bert.encoder.layer.4.output.dense.weight.npz            bert.encoder.layer.7.output.dense.weight.npz bert.encoder.layer.10.attention.output.dense.weight.npz  bert.encoder.layer.2.attention.output.dense.weight.npz  bert.encoder.layer.5.attention.output.dense.weight.npz  bert.encoder.layer.8.attention.output.dense.weight.npz bert.encoder.layer.10.attention.self.key.weight.npz      bert.encoder.layer.2.attention.self.key.weight.npz      bert.encoder.layer.5.attention.self.key.weight.npz      bert.encoder.layer.8.attention.self.key.weight.npz bert.encoder.layer.10.attention.self.query.weight.npz    bert.encoder.layer.2.attention.self.query.weight.npz    bert.encoder.layer.5.attention.self.query.weight.npz    bert.encoder.layer.8.attention.self.query.weight.npz bert.encoder.layer.10.attention.self.value.weight.npz    bert.encoder.layer.2.attention.self.value.weight.npz    bert.encoder.layer.5.attention.self.value.weight.npz    bert.encoder.layer.8.attention.self.value.weight.npz bert.encoder.layer.10.intermediate.dense.weight.npz      bert.encoder.layer.2.intermediate.dense.weight.npz      bert.encoder.layer.5.intermediate.dense.weight.npz      bert.encoder.layer.8.intermediate.dense.weight.npz bert.encoder.layer.10.output.dense.weight.npz            bert.encoder.layer.2.output.dense.weight.npz            bert.encoder.layer.5.output.dense.weight.npz            bert.encoder.layer.8.output.dense.weight.npz bert.encoder.layer.11.attention.output.dense.weight.npz  bert.encoder.layer.3.attention.output.dense.weight.npz  bert.encoder.layer.6.attention.output.dense.weight.npz  bert.encoder.layer.9.attention.output.dense.weight.npz bert.encoder.layer.11.attention.self.key.weight.npz      bert.encoder.layer.3.attention.self.key.weight.npz      bert.encoder.layer.6.attention.self.key.weight.npz      bert.encoder.layer.9.attention.self.key.weight.npz bert.encoder.layer.11.attention.self.query.weight.npz    bert.encoder.layer.3.attention.self.query.weight.npz    bert.encoder.layer.6.attention.self.query.weight.npz    bert.encoder.layer.9.attention.self.query.weight.npz bert.encoder.layer.11.attention.self.value.weight.npz    bert.encoder.layer.3.attention.self.value.weight.npz    bert.encoder.layer.6.attention.self.value.weight.npz    bert.encoder.layer.9.attention.self.value.weight.npz bert.encoder.layer.11.intermediate.dense.weight.npz      bert.encoder.layer.3.intermediate.dense.weight.npz      bert.encoder.layer.6.intermediate.dense.weight.npz      bert.encoder.layer.9.intermediate.dense.weight.npz bert.encoder.layer.11.output.dense.weight.npz            bert.encoder.layer.3.output.dense.weight.npz            bert.encoder.layer.6.output.dense.weight.npz            bert.encoder.layer.9.output.dense.weight.npz
do
    ./spmm_benchmark ../../../../prunned-bert/data/unstruct/${dataset} 512
done